<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="movieMapper">

	<!-- 
		Reply 테이블로부터 조회된 ResultSet을
		Reply VO 타입으로 옮겨주는 ResultMap
	-->
	
	<resultMap id="movieResultSet" type="movie">
		<id column="MOVIE_NO" property="movieNo" />
		<result column="MOVIE_TITLE" property="movieTitle" />
		<result column="PREMIERE" property="premiere" />
		<result column="OPEN_DATE" property="openDate" />
		<result column="DIRECTOR" property="director" />
		<result column="GENRE" property="genre" />
		<result column="RUNTIME" property="runtime" />
		<result column="SCREEN_TYPE" property="screenType" />
		<result column="FILM_RATE" property="filmRate" />
		<result column="DESCRIPTION" property="description" />
		<result column="STARRING" property="starring" />
		<result column="STATUS" property="status" />
		<result column="TRAILER" property="trailer"/>
		
		<!-- 포스터정보,상영정보,상영관정보 추가(결제페이지-형문) -->
		<result column="IMAGE_PATH" property="imagePath"/>
		<result column="FILE_CODENAME" property="fileCodename"/>
		<result column="PLAYING_NO" property="playingNo"/>
		<result column="PLAYTIME" property="playTime"/>
		<result column="SCREEN_NAME" property="screenName"/>
		<result column="SCREEN_INFO" property="screenInfo"/>
		
		
	</resultMap>
	
	<resultMap id ="posterResultSet" type="poster">
		<id column="IMAGE_ID" property="imageId"/>
		<result column="MOVIE_NO" property="movieNo"/>
		<result column="FILE_NAME" property="fileName"/>
		<result column="FILE_CODENAME" property="fileCodename"/>
		<result column="IMAGE_PATH" property="imagePath"/>
		<result column="UPLOAD_DATE" property="uploadDate"/>
		<result column="FILE_LEVEL" property="fileLevel"/>
		<result column="STATUS" property="status"/>	
	</resultMap>
	
	<resultMap id="movieWithPosterFlatResultMap" type="movie">
	    <id column="MOVIE_NO" property="movieNo" />
	    <result column="MOVIE_TITLE" property="movieTitle" />
	    <result column="DESCRIPTION" property="description" />
	    <result column="IMAGE_PATH" property="imagePath" />
	    <result column="FILE_CODENAME" property="fileCodename" />
	    <result column="FILE_LEVEL" property="fileLevel" />
	</resultMap>
	
	
	<!-- 이거 영화 예매 페이지 첫페이지 정보 가져오기 -->
	<select id ="selectList" resultMap="movieResultSet">
		SELECT MOVIE_NO
			, MOVIE_TITLE
			, PREMIERE
			, OPEN_DATE
			, RUNTIME
			, SCREEN_TYPE
			, FILM_RATE
			, DESCRIPTION
			, STARRING
			, STATUS
		FROM MOVIE
	</select>
	
	<!-- 이거 영화 예매 페이지 첫페이지 상세정보 가져오기 -->
	<select id = "selectMovie" parameterType="_int" resultMap="movieWithPosterFlatResultMap">
	
		SELECT 
			M.MOVIE_NO,
		    M.MOVIE_TITLE,
		    M.DESCRIPTION,
		    P.IMAGE_PATH,
		    P.FILE_CODENAME,
            P.FILE_LEVEL
		FROM 
		    FILOOM.MOVIE M
		JOIN 
		    FILOOM.POSTER P
		ON 
		    M.MOVIE_NO = P.MOVIE_NO
		WHERE 
		    M.MOVIE_NO = #{movieNo}
	
	</select>



	<!-- 결제페이지 : 영화,상영정보 조회 -->
	<select id="selectMovieForPlayingNo" parameterType="int" resultMap="movieResultSet">
		SELECT MOVIE_NO, MOVIE_TITLE, DIRECTOR, GENRE, RUNTIME, FILM_RATE, FILE_CODENAME, IMAGE_PATH, PLAYING_NO, PLAYTIME,SCREEN_NAME, SCREEN_INFO
		  FROM MOVIE M 
		  JOIN POSTER  USING(MOVIE_NO)
		  JOIN PLAYING  USING(MOVIE_NO)
		  JOIN SCREEN USING(SCREEN_NO)
		 WHERE PLAYING_NO = #{playingNo}
		   AND FILE_LEVEL = 1
	</select>


</mapper>
