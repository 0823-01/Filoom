<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="couponMapper">

	<resultMap id="couponUserResultSet" type="couponUser">
		<result column="COUPON_NO" property="couponNo"/>
		<result column="USER_NO" property="userNo"/>
		<result column="BOOK_NO" property="bookNo"/>
		<result column="COUPON_USE" property="couponUse"/>
		
		<!-- 필요에 의해 추가(형문) -->
		<result column="COUPON_NAME" property="couponName"/>
		<result column="COUPON_EXP_DATE" property="couponExpDate"/>
	</resultMap>


	<!-- 사용가능한 쿠폰조회(사용기한,상태유뮤) -->
	<select id="selectListCouponUser" parameterType="int" resultMap="couponUserResultSet">
		SELECT CU.* ,C.COUPON_NAME,C.COUPON_EXP_DATE
		  FROM COUPON_USER CU
		  JOIN COUPON C ON (CU.COUPON_NO = C.COUPON_NO)
		 WHERE TRUNC(COUPON_EXP_DATE) > TRUNC(SYSDATE)
		   AND USER_NO = #{userNo}
		   AND BOOK_NO IS NULL
		   AND COUPON_USE = 'X'
		 ORDER BY C.COUPON_EXP_DATE ASC 
		   
				
	</select>

	
</mapper>