<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="eventMapper">

<!-- Event 테이블로부터 조회된 ResultSet을 Event VO 타입으로 옮겨주는 ResultMap -->
<resultMap id="eventResultSet" type="event">
	<id column="EVENT_NO" property="eventNo" />
	<result column="EVENT_TITLE" property="eventTitle" />
	<result column="EVENT_CONTENT" property="eventContent" />
	<result column="START_DATE" property="startDate" />
	<result column="END_DATE" property="endDate" />
	<result column="CONTENTIMG1" property="contentImg1" />
	<result column="EVENT_STATUS" property="eventStatus" />
	<result column="STATUS" property="status" />
	<result column="EVENT_TYPE" property="eventType" />
</resultMap>


<!-- Reply 테이블로부터 조회된 ResultSet을 Reply VO 타입으로 옮겨주는 ResultMap -->
<resultMap id="replyResultSet" type="reply">
	<id column="REPLY_NO" property="replyNo" />
	<result column="REF_ENO" property="refEno" />
	<result column="REPLY_CONTENT" property="replyContent" />
	<result column="REPLY_WRITER" property="replyWriter" />
	<result column="CREATE_DATE" property="createDate" />
	<result column="STATUS" property="status" />
</resultMap>

<!-- EventAttachment 테이블로부터 조회된 ResultSet을 EventAttachment VO 타입으로 옮겨주는 ResultMap -->
<resultMap id="eventAttachmentResultSet" type="eventAttachment">
	<id column="EVNET_FILE_NO" property="eventFileNo" />
	<result column="REF_ENO" property="refEno" />
	<result column="ORIGIN_NAME" property="originName" />
	<result column="CHANGE_NAME" property="changeName" />
	<result column="FILE_PATH" property="filePath" />
	<result column="FILE_LEVEL" property="fileLevel" />
</resultMap>


<!-- 사용자 -->
<!-- 241212 한혜원, 이벤트 게시글 목록조회 -->
<select id="selectList" resultMap="eventResultSet">
	SELECT EVENT_NO
     , EVENT_TITLE
     , CHANGE_NAME AS "CONTENTIMG1"
     , TO_CHAR(START_DATE, 'YYYY-MM-DD') "START_DATE"
     , TO_CHAR(END_DATE, 'YYYY-MM-DD') "END_DATE"
  FROM EVENT E
  JOIN EVENT_ATTACHMENT ON (EVENT_NO = REF_ENO)
 WHERE E.STATUS = 'Y'  
   AND FILE_LEVEL = 1
 ORDER BY EVENT_NO DESC
</select>

<!-- 241213 한혜원 이벤트 종료여부 필터링 목록조회 -->
<select id="selectFilterlist" resultMap="eventResultSet">
	SELECT EVENT_NO
     , EVENT_TITLE
     , CHANGE_NAME AS "CONTENTIMG1"
     , TO_CHAR(START_DATE, 'YYYY-MM-DD') "START_DATE"
     , TO_CHAR(END_DATE, 'YYYY-MM-DD') "END_DATE"
     
  FROM EVENT E
  JOIN EVENT_ATTACHMENT ON (EVENT_NO = REF_ENO)
 WHERE E.EVENT_STATUS = #{eventStatus} 
   AND E.STATUS = 'Y'  
   AND FILE_LEVEL = 1
 ORDER BY EVENT_NO DESC  
</select>

<!-- 241213 한혜원 이벤트 게시글 상세조회 -->
<select id="selectEvent" parameterType="_int" resultMap="eventResultSet">
	SELECT EVENT_NO
     , EVENT_TITLE
     , TO_CHAR(START_DATE, 'YYYY-MM-DD') "START_DATE"
     , TO_CHAR(END_DATE, 'YYYY-MM-DD') "END_DATE"
     , EVENT_CONTENT
     , EVENT_TYPE
  FROM EVENT
 WHERE EVENT_NO = #{eventNo}
   AND STATUS = 'Y'
</select>

<!-- 241213 한혜원 이벤트 게시글 첨부파일 상세조회 -->
<select id="selectEventAttachment" resultMap="eventAttachmentResultSet">
	SELECT EVENT_FILE_NO
     , ORIGIN_NAME
     , CHANGE_NAME
     , FILE_PATH
  FROM EVENT_ATTACHMENT
 WHERE REF_ENO = #{eventNo}
   AND FILE_LEVEL = 2
</select>

<!-- 241217 한혜원 이벤트 게시판 댓글 목록조회 -->
<select id="selectReplyList" resultMap="replyResultSet">
	SELECT REPLY_NO
	     , USER_ID AS "REPLY_WRITER"
	     , REPLY_CONTENT
	     , TO_CHAR(CREATE_DATE, 'YYYY-MM-DD AM HH:MI:SS') AS "CREATE_DATE"
	  FROM REPLY R
	  JOIN MEMBER ON (REPLY_WRITER = USER_NO)
	 WHERE REF_ENO = #{eventNo}
	   AND R.STATUS = 'Y'
</select>

<!-- 241217 한혜원 이벤트 게시판 댓글 작성 -->
<insert id="insertReply" parameterType="reply">
	INSERT INTO REPLY(REPLY_NO, REF_ENO, REPLY_WRITER, REPLY_CONTENT)
	VALUES(SEQ_ERNO.NEXTVAL, #{refEno}, #{replyWriter}, #{replyContent})
</insert>

<!-- 241217 한혜원 이벤트 게시판 댓글 수정 -->
<update id="updateReply" parameterType="reply">
	UPDATE REPLY R
	   SET REPLY_CONTENT = #{replyContent}
	 WHERE REPLY_NO = #{replyNo}
	   AND R.STATUS = 'Y'
</update>


<!-- 관리자 -->
<!-- 241211 한혜원, 이벤트 게시글 등록 -->
<insert id="insertEvent" parameterType="event">
	INSERT INTO EVENT(EVENT_NO, EVENT_TITLE, START_DATE, END_DATE, EVENT_CONTENT, EVENT_TYPE, EVENT_STATUS)
	VALUES(SEQ_ENO.NEXTVAL, #{eventTitle}, #{startDate}, #{endDate}, #{eventContent}, #{eventType}, #{eventStatus})
</insert>

<!-- 241211 한혜원, 이벤트 게시글 첨부파일 등록 -->
<insert id="insertEventAttachment" parameterType="eventAttachment">
	INSERT INTO EVENT_ATTACHMENT(EVENT_FILE_NO, REF_ENO, ORIGIN_NAME, CHANGE_NAME, FILE_PATH, FILE_LEVEL)
	VALUES(SEQ_EFNO.NEXTVAL, SEQ_ENO.CURRVAL, #{originName}, #{changeName}, #{filePath}, #{fileLevel})
</insert>

</mapper>
